<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal Agent Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="brand">
                <div class="brand-icon"></div>
                TEMPORAL AGENT
            </div>
            <div class="header-status">
                <span class="status-dot" id="connectionStatusDot"></span>
                <span id="connectionStatusText">Connecting...</span>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="app-sidebar">
            <nav>
                <div class="nav-item active" data-view="tasks">
                    <span class="nav-icon">üìä</span> Tasks Board
                </div>
                <div class="nav-item" data-view="skills">
                    <span class="nav-icon">üß©</span> Skills Library
                </div>
                <div class="nav-item" data-view="mcps">
                    <span class="nav-icon">üîå</span> MCP Config
                </div>
                <div class="nav-item" data-view="env">
                    <span class="nav-icon">‚öôÔ∏è</span> Environment
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="app-main">

            <!-- Tasks View (Kanban) -->
            <section id="tasks-view" class="view-section active">
                <div class="section-header">
                    <h2 class="section-title">Task Management</h2>
                    <div class="header-right-group">
                        <div class="header-actions">
                            <button class="btn btn-primary" id="createTaskBtn">
                                + New Task
                            </button>
                            <!-- Integration with Workflow runner -->
                            <button class="btn btn-secondary" id="runWorkflowBtn">
                                Run Workflow
                            </button>
                        </div>
                        <div class="header-controls">
                            <div class="sort-group">
                                <span class="label">Sort:</span>
                                <select id="sortTasksSelect" class="btn btn-secondary select-input">
                                    <option value="created_desc">Created (Newest)</option>
                                    <option value="created_asc">Created (Oldest)</option>
                                    <option value="completed_desc">Completed (Newest)</option>
                                    <option value="completed_asc">Completed (Oldest)</option>
                                </select>
                            </div>
                            <div class="view-toggles">
                                <button class="btn btn-secondary active" id="viewKanbanBtn">KB</button>
                                <button class="btn btn-secondary" id="viewListBtn">List</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="tasks-kanban" class="kanban-board">
                    <!-- Column: Pending -->
                    <div class="kanban-column" id="col-pending" data-status="pending">
                        <div class="column-header">
                            <span>Pending</span>
                            <span class="column-count" id="count-pending">0</span>
                        </div>
                        <div class="task-list-container" id="list-pending">
                            <!-- Tasks injected here -->
                        </div>
                    </div>

                    <!-- Column: In Progress -->
                    <div class="kanban-column" id="col-in_progress" data-status="in_progress">
                        <div class="column-header">
                            <span>In Progress</span>
                            <span class="column-count" id="count-in_progress">0</span>
                        </div>
                        <div class="task-list-container" id="list-in_progress">
                            <!-- Tasks injected here -->
                        </div>
                    </div>

                    <!-- Column: Completed -->
                    <div class="kanban-column" id="col-completed" data-status="completed">
                        <div class="column-header">
                            <span>Completed</span>
                            <span class="column-count" id="count-completed">0</span>
                        </div>
                        <div class="task-list-container" id="list-completed">
                            <!-- Tasks injected here -->
                        </div>
                    </div>
                </div>

                <!-- List View -->
                <div id="tasks-list-view" style="display: none;">
                    <table
                        style="width: 100%; border-collapse: collapse; background: var(--background); border: 1px solid var(--border);">
                        <thead style="background: var(--surface); border-bottom: 2px solid var(--primary);">
                            <tr>
                                <th style="padding: 12px; text-align: left;">ID</th>
                                <th style="padding: 12px; text-align: left;">Description</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Workflow</th>
                                <th style="padding: 12px; text-align: left;">Created</th>
                                <th style="padding: 12px; text-align: left;">Started</th>
                                <th style="padding: 12px; text-align: left;">Completed</th>
                                <th style="padding: 12px; text-align: left;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasks-list-body">
                            <!-- Rows injected here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Skills View -->
            <section id="skills-view" class="view-section">
                <!-- Skills Grid (List) -->
                <div id="skills-grid-view">
                    <div class="section-header">
                        <h2 class="section-title">Skills Library</h2>
                        <button class="btn btn-primary" id="createSkillBtn">
                            + New Skill
                        </button>
                    </div>
                    <div id="skills-list"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                        <!-- Skills injected here -->
                    </div>
                </div>

                <!-- Skill Details (File Explorer) -->
                <div id="skill-details-view" style="display: none; height: 100%;">
                    <div class="section-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="btn btn-secondary" onclick="window.closeSkillDetails()">‚Üê Back</button>
                            <h2 class="section-title" id="currentSkillName">Skill Name</h2>
                        </div>
                    </div>

                    <div class="skill-details-container">
                        <!-- Sidebar -->
                        <div class="skill-sidebar">
                            <div class="skill-sidebar-header">
                                <span>Files</span>
                                <button class="btn btn-sm" onclick="window.addSkillFile()"
                                    style="font-size: 11px; padding: 2px 6px;">+</button>
                            </div>
                            <div id="skill-file-tree" class="file-tree">
                                <!-- Tree items injected here -->
                            </div>
                        </div>

                        <!-- Editor -->
                        <div class="skill-editor-area">
                            <div class="editor-header">
                                <span id="currentFileName" style="font-weight: 500; font-size: 13px;">Select a
                                    file</span>
                                <button class="btn btn-primary" id="saveSkillFileBtn" disabled>Save</button>
                            </div>
                            <div class="editor-content" id="skillEditorContainer">
                                <div class="empty-state">Select a file to edit</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MCP Config View -->
            <section id="mcps-view" class="view-section">
                <div class="section-header">
                    <h2 class="section-title">MCP Configuration</h2>
                    <button class="btn btn-primary" id="saveMcpBtn">
                        Save Config
                    </button>
                </div>
                <div class="form-group">
                    <label class="form-label">mcp_config.json</label>
                    <textarea id="mcpEditor" class="input-field"
                        style="font-family: monospace; height: 500px;"></textarea>
                </div>
            </section>

            <!-- Environment View -->
            <section id="env-view" class="view-section">
                <div class="section-header">
                    <h2 class="section-title">Environment Variables</h2>
                    <button class="btn btn-primary" id="addEnvBtn">
                        + Add Variable
                    </button>
                </div>
                <div class="card">
                    <div class="form-group">
                        <div style="background: #fdf6e3; padding: 15px; margin-bottom: 20px; font-size: 14px;">
                            Note: Values are read from <code>.env</code> file.
                        </div>
                        <div id="env-vars-container">
                            <!-- Env vars list -->
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modals -->

    <!-- Create Task Modal -->
    <div id="taskModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">New Task</h3>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="taskDescription" class="input-field" required
                        placeholder="Describe what the agent needs to do..."></textarea>
                </div>
                <!-- Optional: Workflow Selection -->
                <div class="form-group">
                    <label class="form-label">Workflow (Optional)</label>
                    <input type="text" id="taskWorkflow" class="input-field" placeholder="manual">
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Skill Modal -->
    <div id="skillModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">New Skill</h3>
            <form id="skillForm">
                <div class="form-group">
                    <label class="form-label">Skill Name (Folder Name)</label>
                    <input type="text" id="skillName" class="input-field" required placeholder="e.g. data-analysis">
                </div>
                <div class="form-group">
                    <label class="form-label">Content (SKILL.md)</label>
                    <textarea id="skillContent" class="input-field" required
                        style="height: 300px; font-family: monospace;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Skill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Env Modal -->
    <div id="envModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">Add Environment Variable</h3>
            <form id="envForm">
                <div class="form-group">
                    <label class="form-label">Key</label>
                    <input type="text" id="envKey" class="input-field" required placeholder="API_KEY">
                </div>
                <div class="form-group">
                    <label class="form-label">Value</label>
                    <input type="text" id="envValue" class="input-field" required placeholder="secret-value">
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Variable</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">Edit Task</h3>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="editTaskDescription" class="input-field" required
                        placeholder="Update task description..."></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div id="taskDetailsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="detail-title" style="margin-bottom: 10px;">Task Details</h3>
            <div id="detail-meta" style="margin-bottom: 20px; font-size: 14px; color: #666;"></div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <div id="detail-desc" style="background: #f8f8f8; padding: 12px; border: 1px solid #ddd;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Output</label>
                <pre id="detail-output" style="max-height: 300px; overflow-y: auto; white-space: pre-wrap;"></pre>
            </div>

            <div id="detail-error-group" class="form-group" style="display: none;">
                <label class="form-label" style="color: var(--error);">Error</label>
                <div id="detail-error"
                    style="background: #fff0f0; padding: 12px; border: 1px solid #ffcccc; color: var(--error);"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Generated Files</label>
                <div id="detail-files"
                    style="border: 1px solid #eee; padding: 10px; background: #fafafa; min-height: 50px;">
                    <div style="color: #999; text-align: center; font-size: 13px;">Loading files...</div>
                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                <button type="button" class="btn btn-secondary close-modal">Close</button>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="filePreviewModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 90vw; height: 90vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 id="previewTitle" style="margin: 0;">File Preview</h3>
                <div style="display: flex; gap: 10px;">
                    <a id="previewDownloadBtn" class="btn btn-primary" href="#" download>Download</a>
                    <button type="button" class="btn btn-secondary close-modal">Close</button>
                </div>
            </div>
            <div id="previewContent"
                style="flex: 1; border: 1px solid #eee; background: white; overflow: hidden; position: relative;">
                <!-- Content injected here (iframe, img, pre) -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 id="confirmTitle" style="margin-bottom: 20px;">Confirm</h3>
            <p id="confirmMessage" style="margin-bottom: 30px; color: #666;">Are you sure?</p>
            <div style="display: flex; justify-content: center; gap: 10px;">
                <button type="button" class="btn btn-secondary close-modal" id="confirmCancelBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js?v=2"></script>
</body>

</html>